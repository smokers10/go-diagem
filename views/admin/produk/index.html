<!doctype html>
<html lang="en" class="no-focus">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">

        <title>Admin | Tokonya</title>

        <meta name="description" content="Tokonya">
        <meta name="author" content="Tokonya">
        <meta name="robots" content="noindex, nofollow">

        <!-- Open Graph Meta -->
        <meta property="og:title" content="Tokonya">
        <meta property="og:site_name" content="Tokonya">
        <meta property="og:description" content="Tokonya">
        <meta property="og:type" content="website">
        <meta property="og:url" content="">
        <meta property="og:image" content="">

        <!-- Page JS Plugins CSS -->
        <link rel="stylesheet" href="/js/plugins/datatables-v2/datatables.min.css">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/8.11.8/sweetalert2.min.css">

        <!-- Fonts, Styles and Codebase framework -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli:300,400,400i,600,700">
        <link rel="stylesheet" id="css-main" href="/css/app.css">
        <style>
            #list-produk_filter {
                display: none;
            }
        </style>
    </head>
    <body>
        <div id="page-container" class="sidebar-o enable-page-overlay side-scroll page-header main-content-boxed">
            <!-- Sidebar -->
            {{template "partials/admin-sidebar" .}}
            <!-- END Sidebar -->

            <!-- Header -->
            {{template "partials/admin-header" .}}
            <!-- END Header -->

            <!-- Main Container -->
            <main id="main-container">

                <!-- Page Content -->
                <div class="content">
                    <div class="content-heading pt-3 mb-3">
                        <a href="/admin/produk/rambah" class="btn btn-secondary float-right mr-5 btn-sm">
                            <i class="si si-plus mr-1"></i>
                            Tambah Produk
                        </a>
                        Katalog Produk
                    </div>

                    <div class="block block-rounded">
                        <div class="block-header block-header-default">
                            <div class="block-title">
                                <strong>Daftar Produk</strong>
                            </div>
                        </div>
                        <div class="block-content pb-15">
                            <table>
                                <table id="data-barang" class="table" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>Nama Barang</th>
                                            <th>Harga</th>
                                            <th>Stok</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                </table>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- END Page Content -->

            </main>
            <!-- END Main Container -->

            <!-- Footer -->
            {{template "partials/admin-footer" .}}
            <!-- END Footer -->
        </div>
        <script src="/js/laravel.app.js"></script>
        <script src="/js/laroute.js"></script>
        <script src="/js/plugins/jquery-validation/jquery.validate.min.js"></script>
        <script src="/js/plugins/datatables-v2/datatables.min.js"></script>
        <script src="/js/plugins/datatables-v2/DataTables-1.11.3/js/dataTables.bootstrap4.min.js"></script>
        <script src="/js/plugins/bootstrap-notify/bootstrap-notify.min.js"></script>
        <script src="/js/common.js"></script>
        <script src="/js/functions.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/accounting.js/0.4.1/accounting.min.js"></script>

        <script>
            var toRupiah = new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
            })
            $('#data-barang').DataTable({
                "ajax":"/admin/produk/get",
                "columns":[
                    {
                        "data":null,
                        "render": function(data, type, row) {
                            return `
                            <div class="media">
                            <img class="media-object" src="${ data.produk_single_foto.path ? data.produk_single_foto.path : "/img/placeholder.png" }" style="width:45px">
                                <div class="media-body ml-3">
                                    <div class="font-size-h6 font-w700 mb-0">
                                        <a href="/admin/produk/edit/${data.id}" target="_blank">${ data.nama }</a>
                                    </div>
                                    <span class="text-primary">${ data.kategori.nama }</span>
                                </div>
                            </div>
                            `
                        }
                    },
                    {
                        "data":null,
                        "render":function(data, type, row){
                            return data.harga ? toRupiah.format(data.harga) : `<a href="/admin/produk/edit/${data.id}">lihat detail</a>`
                        }
                    },
                    {
                        "data":null,
                        "render":function(data, type, row){
                            return data.stok ? data.stok : `<a href="/admin/produk/edit/${data.id}">lihat detail</a>`
                        }
                    },
                    {
                        "data":null,
                        "orderable":false,
                        "render":function(data, type, row){
                            return `
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-secondary btn-sm dropdown-toggle" id="actionButton-${ data.id }" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    OPSI
                                </button>

                                <div class="dropdown-menu" aria-labelledby="actionButton-${ data.id }">
                                    <a class="dropdown-item" href="/admin/produk/edit/${ data.id }">
                                        <i class="si si-note mr-5"></i>Ubah
                                    </a>
                                    <a class="dropdown-item btn-hapus" href="javascript:void(0)" onClick="hapus('`+ data.id +`')">
                                        <i class="si si-trash mr-5"></i>Hapus
                                    </a>
                                </div>
                            </div>
                            `
                        }
                    }
                ],
            })

            function hapus(id) {
                Swal.fire({
                    title: "Anda Yakin?",
                    text: "Data Yang Dihapus Tidak Akan Bisa Dikembalikan",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonText: 'Ya, Hapus!',
                    cancelButtonText: 'Tidak, Batalkan!',
                    reverseButtons: true,
                    allowOutsideClick: false,
                    confirmButtonColor: '#af1310',
                    cancelButtonColor: '#fffff',
                })
                .then((result) => {
                    if (result.value) {
                    $.ajax({
                        url: '/admin/produk/delete',
                        type: "DELETE",
                        data: {id},
                        beforeSend: function(){
                            Swal.fire({
                                title: 'Tunggu Sebentar...',
                                text: ' ',
                                imageUrl: '/img/loading.gif',
                                showConfirmButton: false,
                                allowOutsideClick: false,
                            })
                        },
                        success: function(data) {
                            Swal.fire({
                                title: "Berhasil",
                                text: 'Produk Berhasil Dihapus!',
                                timer: 3000,
                                showConfirmButton: false,
                                icon: 'success'
                            })
                            setTimeout(() => {
                                location.reload()
                            }, 3000)
                        },
                        error: function(jqXHR, textStatus, errorThrown) {
                            Swal.close()
                            alert('Error deleting data')
                        }
                    })
                    }else{
                        Swal.close()
                    }
                })
            }
        </script>
    </body>
</html>
