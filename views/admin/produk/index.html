<!doctype html>
<html lang="en" class="no-focus">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">

        <title>Admin | Tokonya</title>

        <meta name="description" content="Tokonya">
        <meta name="author" content="Tokonya">
        <meta name="robots" content="noindex, nofollow">

        <!-- Open Graph Meta -->
        <meta property="og:title" content="Tokonya">
        <meta property="og:site_name" content="Tokonya">
        <meta property="og:description" content="Tokonya">
        <meta property="og:type" content="website">
        <meta property="og:url" content="">
        <meta property="og:image" content="">

        <!-- Page JS Plugins CSS -->
        <link rel="stylesheet" href="/js/plugins/datatables/dataTables.bootstrap4.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/8.11.8/sweetalert2.min.css">

        <!-- Fonts, Styles and Codebase framework -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli:300,400,400i,600,700">
        <link rel="stylesheet" id="css-main" href="/css/app.css">
        <style>
            #list-produk_filter {
                display: none;
            }
        </style>
    </head>
    <body>
        <div id="page-container" class="sidebar-o enable-page-overlay side-scroll page-header main-content-boxed">
            <!-- Sidebar -->
            {{template "partials/admin-sidebar" .}}
            <!-- END Sidebar -->

            <!-- Header -->
            {{template "partials/admin-header" .}}
            <!-- END Header -->
            
            <!-- Main Container -->
            <main id="main-container">

                <!-- Page Content -->
                <div class="content">
                    <div class="content-heading pt-3 mb-3">
                        <a href="/admin/produk/tambah" class="btn btn-secondary float-right mr-5 btn-sm">
                            <i class="si si-plus mr-1"></i>
                            Tambah Produk
                        </a>
                        Katalog Produk
                    </div>

                    <div class="block block-rounded block-shadow block-bordered d-md-block d-none mb-10">
                        <div class="block-content p-2">
                            <div class="row justify-content-between">
                                <div class="col-4">
                                    <div class="has-search">
                                        <i class="fa fa-search"></i>
                                        <input type="search" class="form-control" id="search-data-list" name="keyword">
                                    </div>
                                </div>
                                <div class="col-4">
                                </div>
                                <div class="col-4">
                                    <div class="row">
                                        <div class="col-md-8 m-auto text-right" id="content-nav">
                                            <span>Navigasi</span>
                                        </div>
                                        <div class="col-md-4 pt-25 pl-0">
                                            <button type="button" class="btn btn-alt-secondary float-right" id="next-data-list">
                                                <i class="fa fa-chevron-right fa-fw"></i>
                                            </button>
                                            <button type="button" class="btn btn-alt-secondary float-left" id="prev-data-list">
                                                <i class="fa fa-chevron-left fa-fw"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="block block-rounded block-shadow block-bordered mb-5">
                        <div class="block-content px-0 py-0">
                            <input type="hidden" id="current_page" value="1">
                            <table class="table table-striped table-vcenter table-hover mb-0" id="data-list">
                                <thead class="thead-light">
                                    <tr>
                                        <th width="5%"></th>
                                        <th width="40%">Nama Produk</th>
                                        <th width="15%">Harga</th>
                                        <th width="25%">Stok</th>
                                        <th width="9%">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr id="loading" class="data-row d-none">
                                        <td colspan="7">
                                            <div class="row justify-content-center">
                                                <div class="col-lg-6 text-center py-50">
                                                    <div class="spinner-border text-primary wh-50" role="status">
                                                        <span class="sr-only">Loading...</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- END Page Content -->

            </main>
            <!-- END Main Container -->

            <!-- Footer -->
            {{template "partials/admin-footer" .}}
            <!-- END Footer -->
        </div>
        <script src="/js/laravel.app.js"></script>
        <script src="/js/laroute.js"></script>
        <script src="/js/plugins/jquery-validation/jquery.validate.min.js"></script>
        <script src="/js/plugins/datatables/jquery.dataTables.min.js"></script>
        <script src="/js/plugins/datatables/dataTables.bootstrap4.min.js"></script>
        <script src="/js/plugins/bootstrap-notify/bootstrap-notify.min.js"></script>
        <script src="/js/common.js"></script>
        <script src="/js/functions.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/accounting.js/0.4.1/accounting.min.js"></script>
        <script src="/js/admin/general.js"></script>
        <script>
            $('.dataTables_filter input[type="search"]').
            attr('placeholder','Search in this blog ....').
            css({'width':'500px','display':'inline-block'})

            $.extend( true, $.fn.dataTable.defaults, {
                "responsive": true,
                "pageLength": 20,
                "lengthChange": false,
                "language": {
                    'loadingRecords': '&nbsp;',
                    "sEmptyTable":	 "Tidak ada data yang tersedia pada tabel ini",
                    "sProcessing":   '<div class="spinner-grow text-primary pt-25" role="status"><span class="sr-only">Loading...</span></div>',
                    "sLengthMenu":   "Tampilkan _MENU_",
                    "sZeroRecords":  "Tidak ditemukan data yang sesuai",
                    "sInfo":         "Menampilkan _START_ sampai _END_ dari _TOTAL_ entri",
                    "sInfoEmpty":    "Menampilkan 0 sampai 0 dari 0 entri",
                    "sInfoFiltered": "(disaring dari _MAX_ entri keseluruhan)",
                    "sInfoPostFix":  "",
                    "sSearch":       "Cari:",
                    "sUrl":          "",
                    "oPaginate": {
                        "sFirst":    "Pertama",
                        "sPrevious": "Sebelumnya",
                        "sNext":     "Selanjutnya",
                        "sLast":     "Terakhir"
                    }
                },
            })

            jQuery(function() {
                load_content();

                // Filter Table
                $('#search-data-list').on('input', function(){
                    clearTimeout(this.delay)
                    this.delay = setTimeout(function(){
                    $(this).trigger('search')
                    }.bind(this), 800)
                }).on('search', function(){
                    load_content()
                    $('#current_page').val(1)
                })

                // Navigation Table
                $('#next-data-list').on('click', function(){
                    old = parseInt($('#current_page').val())
                    old += 1
                    $('#current_page').val(old)
                    load_content()
                })

                $('#prev-data-list').on('click', function(){
                    old = parseInt($('#current_page').val())
                    old -= 1
                    $('#current_page').val(old)
                    load_content()
                })

                $('a.btn-hapus').on('click', function(){
                    alert('asdsa')
                })
            })

            function hapus(id) {
                Swal.fire({
                    title: "Anda Yakin?",
                    text: "Data Yang Dihapus Tidak Akan Bisa Dikembalikan",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonText: 'Ya, Hapus!',
                    cancelButtonText: 'Tidak, Batalkan!',
                    reverseButtons: true,
                    allowOutsideClick: false,
                    confirmButtonColor: '#af1310',
                    cancelButtonColor: '#fffff',
                })
                .then((result) => {
                    if (result.value) {
                    $.ajax({
                        url: '',
                        type: "GET",
                        dataType: "JSON",
                        beforeSend: function(){
                            Swal.fire({
                                title: 'Tunggu Sebentar...',
                                text: ' ',
                                imageUrl: 'public/img/loading.gif',
                                showConfirmButton: false,
                                allowOutsideClick: false,
                            })
                        },
                        success: function(data) {
                            Swal.fire({
                                title: "Berhasil",
                                text: 'Produk Berhasil Dihapus!',
                                timer: 3000,
                                showConfirmButton: false,
                                icon: 'success'
                            })
                            load_content()
                        },
                        error: function(jqXHR, textStatus, errorThrown) {
                            Swal.close()
                            alert('Error deleting data')
                        }
                    })
                    }else{
                        Swal.close()
                    }
                })
            }

            function load_content(){
                var keyword = $('#search-data-list').val()
                var page = $('#current_page').val()

                var navNext = $('#next-data-list')
                var navPrev = $('#prev-data-list')
                
                $.ajax({
                    url: '/admin/produk/get',
                    type: "GET",
                    dataType: "JSON",
                    data: {
                        nama : "",
                        kategori_id: ""
                    },
                    beforeSend: function(){
                        $('#data-list tbody tr#loading').removeClass('d-none')
                        navNext.prop('disabled', true)
                        navPrev.prop('disabled', true)
                    },
                    success: function(response) {
                        $('#data-list tbody tr').not('#data-list tbody tr#loading').remove()

                        var row = ""
                        if(response.data.length !== 0){
                            $.each(response.data, function(k, item) {
                                row += create_element(item)
                            })
                        }else{
                            row = `<tr>
                                <td colspan="5">
                                    <div class="text-center">
                                        <img class="img-fluid" src="">
                                        <div>
                                            <h3 class="font-size-24 font-w600 mt-3">Data Tidak Ditemukan</h3>
                                        </div>
                                    </div>
                                </td>
                            </tr>`
                        }
                        $('#data-list tbody').append(row)

                        // Table Navigation
                        response.next_page_url !== null ? navNext.prop('disabled', false) : navNext.prop('disabled', true)
                        response.prev_page_url !== null ? navPrev.prop('disabled', false) : navPrev.prop('disabled', true)
                        if(response.total === 0){
                            var navigasi = '0 - 0 / 0'
                        }else{
                            var navigasi = response.from +' - '+ response.to +' / '+ response.total
                        }
                        $('#content-nav span').html(navigasi)
                    },
                    complete: function(){
                        $('#data-list tbody tr#loading').addClass('d-none')
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        alert('Error deleting data')
                    }
                })
            }

            function create_element(item){
                let row = `<tr>
                    <td>#</td>
                    <td>
                        <div class="media">
                        <img class="media-object" src="${ item.produk_single_foto.path }" style="width:45px">
                            <div class="media-body ml-3">
                                <div class="font-size-h6 font-w700 mb-0">
                                    <a href="#" target="_blank">${ item.nama }</a>
                                </div>
                                <span class="text-primary">${ item.kategori.nama }</span>
                            </div>
                        </div>
                    </td>
                    <td>
                        ${ item.harga }
                    </td>
                    <td>
                        ${ item.stok }
                    </td>
                    <td class="text-center">
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-secondary btn-sm dropdown-toggle" id="actionButton-${ item.id }" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                OPSI
                            </button>
                            <div class="dropdown-menu" aria-labelledby="actionButton-${ item.id }">
                                <a class="dropdown-item" href="#">
                                    <i class="si si-note mr-5"></i>Ubah
                                </a>
                                <a class="dropdown-item btn-hapus" href="javascript:void(0)" onClick="hapus('`+ item.id +`')">
                                    <i class="si si-trash mr-5"></i>Hapus
                                </a>
                            </div>
                        </div>
                    </td>
                </tr>`

                return row
            }
        </script>
    </body>
</html>
