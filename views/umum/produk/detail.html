<!doctype html>
<html lang="en" class="no-focus">
    <head>

        <title>Diagem</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
        <meta name="description" content="Diagem">
        <meta name="author" content="Diagem">
        <meta name="robots" content="noindex, nofollow">

        <!-- Open Graph Meta -->
        <meta property="og:title" content="Diagem">
        <meta property="og:site_name" content="Diagem">
        <meta property="og:description" content="Diagem">
        <meta property="og:type" content="website">
        <meta property="og:url" content="">
        <meta property="og:image" content="">


        <!-- Icons -->
        <!-- The following icons can be replaced with your own, they are used by desktop and mobile browsers -->
        <link rel="shortcut icon" href="/img/favicons/favicon.png">
        <link rel="icon" type="image/png" sizes="192x192" href="/img/favicons/favicon-192x192.png">
        <link rel="apple-touch-icon" sizes="180x180" href="/img/favicons/apple-touch-icon-180x180.png">
        <!-- END Icons -->

        <!-- Fonts and Codebase framework -->
        <link rel="stylesheet" id="css-main" href="/css/app.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,400,400i,600,700&display=swap">
        <link rel="stylesheet" id="css-main" href="/js/plugins/slick/slick-theme.css">
        <link rel="stylesheet" id="css-main" href="/js/plugins/slick/slick.css">
        <style>
            .prodPrice {
                font-size: 2rem;
                font-weight: 700;
                color: orange;
                text-decoration: none;
            }
            .sticky {
                position: fixed;
                top: 0;
                z-index: 1030;
                margin-top: 70px;
            }
        
            /* .sticky + .content {
                padding-top: 60px;
            } */
        
            .sticky-navigation{
                background: #fff;
                border-bottom: 1px solid #e0e0e0;
                display: -webkit-box;
                display: -ms-flexbox;
                overflow: hidden;
            }
        </style>
    </head>
    <body class="bg-white">
        <div id="page-container" class="sidebar-inverse side-scroll page-header-fixed main-content-boxed">
            <!-- Header -->
            {{if .Logged.IsLogged}}
                {{template "partials/user-header" .}}
                {{else}}
                {{template "partials/user-unlogged-header" .}}
            {{end}}
            <!-- END Header -->

            <!-- Main Container -->
            <main id="main-container">
                <!-- Page Content -->
                <div class="bg-white">
                    <div class="content content-full">
                        <div class="row">
                            <div class="col-md-5">
                                <div class="product-slides mb-0">
                                    <!-- for each image foto -->
                                    <div class="item-detail">
                                        <img class="img-fluid" src="/img/placeholder/product.png" id="foto-produk-main" alt="Image Description">
                                    </div>
                                </div>
                                <div class="product-slides-nav row" id="foto-produk-nav"></div>
                            </div>

                            <div class="col-md-7">
                                <div class="product-title" id="nama-produk">Nama Produk</div>
                                <div class="product-rating" data-score="3" data-star-on="fa fa-fw fa-star text-warning" data-star-off="fa fa-fw fa-star text-muted"></div>
                                <div class="product-price mb-3">
                                    <div class="product-price_final">
                                        <span class="product-price__after" id="harga-produk">Harga Produk</span>
                                    </div>
                                    <div class="product-strikethrough_price" id="discount">
                                        <span class="product-price__before" id="harga-produk-original"></span>
                                        <span class="product-price__discount" id="besaran-discount"></span>
                                    </div>
                                </div>

                                <form id="option-choice-form" method="POST" onsubmit="return false;">
                                    <input type="hidden" id="id-produk" name="id">
                                    <input type="hidden" id="harga-original" name="harga-original">
                                    <input type="hidden" id="discount-form" name="discount-form">
                                    <input type="hidden" id="subtotal-form" name="subtotal-form">
                                    <input type="hidden" id="id-varian" name="id-varian">

                                    <div id="varian-produk" class="product-variant"></div>

                                    <div class="product-subtotal" id="varian-section">
                                        <label class="product-label">Varian</label>
                                        <div class="product-price" id="variasi"></div>
                                    </div>

                                    <div class="product-quantity d-flex">
                                        <label class="product-label">Kuantitas</label>
                                        <div class="cart-quantity">
                                            <button class="btn-qty" type="button" data-type="minus">
                                                <i class="fa fa-minus"></i>
                                            </button>
                                            <input type="text" id="buy-quantity" name="quantity" class="input-number" value="1" data-min="1" data-max="10">
                                            <button class="btn-qty" type="button" data-type="plus">
                                                <i class="fa fa-plus"></i>
                                            </button>
                                        </div>
                                        <div class="product-available">
                                            <span class="label">Stok :&nbsp; <b id="stok">n/a</b></span>
                                        </div>
                                    </div>
                    
                                    <div class="product-subtotal">
                                        <label class="product-label">Subtotal</label>
                                        <div class="product-price" id="subtotal">Harga</div>
                                    </div>
                                </form>

                                <div class="product-action">
                                    <button href="#" class="btn btn-outline-primary font-weight-bold mr-1" id="btn-add-cart">
                                        <i class="si si-plus mr-1"></i>
                                        Masukan Keranjang
                                    </button>
                                    <button href="#" class="btn btn btn-primary font-weight-bold" id="btn-buy-now">
                                        Beli Sekarang
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-body">
                    <div class="content">
                        <div class="block">
                            <div class="block-header p-0 sticky-navigation">
                                <ul class="nav nav-tabs nav-tabs-alt" id="myTab" role="tablist">
                                    <li class="nav-item">
                                      <a class="nav-link active" id="spec-tab" data-toggle="tab" href="#spec" role="tab" aria-controls="spec" aria-selected="true">Spesifikasi</a>
                                    </li>
    
                                    <li class="nav-item">
                                      <a class="nav-link" id="description-tab" data-toggle="tab" href="#description" role="tab" aria-controls="description" aria-selected="false">Deskripsi</a>
                                    </li>
    
                                    <li class="nav-item">
                                      <a class="nav-link" id="feedback-tab" data-toggle="tab" href="#feedback" role="tab" aria-controls="feedback" aria-selected="false">Ulasan</a>
                                    </li>
                                </ul>
                            </div>

                            <div class="tab-content block-content" id="myTabContent">
                                <div class="tab-pane fade show active" id="spec" role="tabpanel" aria-labelledby="spec-tab">
                                    <h4 class="font-w400">Spesifikasi</h4>
                                    <table class="table" id="table-spec">
                                        <tbody>

                                        </tbody>
                                    </table>
                                </div>
                                <div class="tab-pane fade" id="description" role="tabpanel" aria-labelledby="description-tab">
                                    <h4 class="font-w400">Deskripsi</h4>
                                    <div id="deskripsi"></div>
                                </div>
                                <div class="tab-pane fade" id="feedback" role="tabpanel" aria-labelledby="feedback-tab">
                                    <h4 class="font-w400">Ulasan</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END Page Content -->
            </main>
            <!-- END Main Container -->

            <!-- Footer -->
            {{template "partials/footer" .}}
            <!-- END Footer -->
        </div>
        <script src="/js/laravel.app.js"></script>
        <script src="/js/laroute.js"></script>
        <script src="/js/plugins/jquery-validation/jquery.validate.min.js"></script>
        <script src="/js/umum/general.js"></script>
        <script src="/js/functions.js"></script>
        <script src="/js/plugins/slick/slick.js"></script>
        <script src="/js/plugins/jquery-raty/jquery.raty.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jquery-zoom@1.7.21/jquery.zoom.min.js"></script>
        <script>
            const currentPath = location.pathname
            const CPSplit = currentPath.split("/")  
            const slug = CPSplit[3]
            const toRupiah = new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
            })

            $("#varian-section").hide()

            $(document).ready(function(){
                $("#discount").hide()

                $("body").scrollspy({
                    target: "#product-nav",
                    offset: 583
                })

                $.ajax({
                    url:`/produk/get/${slug}`,
                    success: function(response) {
                        const data = response.data
                        const { 
                            nama, kode, harga, berat, satuan_berat, stok, tinggi, lebar, panjang,
                            kategori, produk_foto, deskripsi, spesifikasi, id, is_has_variant,
                            variasi, discount
                        } = data

                        // set to DOM
                        $("#nama-produk").text(nama)
                        $("#deskripsi").html(deskripsi)
                        $("#stok").text(stok)

                        // set value
                        $("#id-produk").val(id)
                        $("#harga-original").val(harga)
                        $("#discount-form").val(discount)

                        _initialPriceState(discount, harga)
                        
                        // produk foto
                        produk_foto.forEach(data => {
                            if (data.is_utama) {
                                $("#foto-produk-main").attr("src", data.path)
                            }
                            $("#foto-produk-nav").append(_createImageNav(data.path))
                        })

                        // ngisi table spek
                        spesifikasi.forEach(el => {
                            $("#table-spec > tbody").append(`
                                <tr>
                                    <td><b>${el.nama}</b></td>
                                    <td>${el.value}</td>
                                <tr>
                            `)
                        })

                        // jika punya variasi
                        if (is_has_variant) {
                            $("#varian-section").show()
                            variasi.forEach(data => {
                                $("#variasi").append(_createVariantElement(data))
                            })
                        }
                    }
                })
            })

            $(".btn-qty").on("click", function () {
                var tipe = $(this).attr("data-type")
                var subtotalForm = $("#subtotal-form")
                var bqty = parseInt($("#buy-quantity").val())
                var hargaOriginal = parseInt($("#harga-original").val())
                
                // perhitungan subtotal
                var besaranDiscount = parseInt($("#discount-form").val())
                var discount =  besaranDiscount / 100
                var potongan = hargaOriginal - (hargaOriginal * discount)
                
                // processed subtotal
                var subtotal 
                var qty
                
                // pengurangan / penambahan stok yang dibeli
                if (tipe == "minus") {
                    qty = bqty - 1
                } else {
                    qty = bqty + 1
                }

                // set buy quantity
                $("#buy-quantity").val(qty)

                // pengurangan / penambahan subtotal
                if (besaranDiscount > 0) {
                    subtotal = potongan * qty
                }else {
                    subtotal = hargaOriginal * qty
                }
                
                subtotalForm.val(subtotal)
                $("#subtotal").text(toRupiah.format(subtotal))
            })

            function _createVarianElement(data) {
                return `
                    <label class="product-label">${data.variant}</label>
                    <div class="product-variant-item">
                        <label for="nilai_Varian" class="radio-chip b-outline b-secondary">
                            <input type="radio" id="nilai_Varian" name="var1" value="nilai">
                            <span>nilai</span>
                        </label>
                    </div>
                `
            }

            function _createImageNav(path) {
                return `
                    <div class="slider-nav__item co-4">
                        <img src="${path}" class="h-100" alt="navigasi foto" />
                    </div>
                `
            }

            function _createVariantElement(data) {
                let {id, harga, stok, variant} = data
                return `
                    <button href="#" class="btn btn-outline-secondary mr-1 mb-3" data-id="${id}" data-harga="${harga}" data-stok="${stok}" onclick="_chooseVarian(this)">
                        ${variant}
                    </button>
                `
            }

            function _initialPriceState(discount, harga) {
                let discountToInt = parseInt(discount)
                let persentase = discountToInt / 100
                var subtot
                var potongan = harga - (harga * persentase)

                if(discountToInt > 0) {
                    subtot = parseInt($("#buy-quantity").val()) * potongan
                    $("#discount").show()
                    $("#besaran-discount").text(`${discount}%`)
                    $("#harga-produk").text(toRupiah.format(potongan))
                    $("#harga-produk-original").text(toRupiah.format(harga))
                    $("#subtotal").text(toRupiah.format(subtot)) 
                }else {
                    subtot = parseInt($("#buy-quantity").val()) * harga
                    $("#harga").text(toRupiah.format(harga))
                    $("#harga-produk").text(toRupiah.format(harga))
                    $("#subtotal").text(toRupiah.format(subtot)) 
                }

                $("#subtotal-form").val(subtot)
            }

            function _chooseVarian(data) {
                let el = $(data)
                let harga = el.attr("data-harga")
                let id = el.attr("data-id")
                let stok = el.attr("data-stok")
                console.log(harga, id, stok)
            }

        </script>
    </body>
</html>
